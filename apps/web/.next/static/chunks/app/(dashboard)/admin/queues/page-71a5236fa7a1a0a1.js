(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[67],{392:(e,s,a)=>{Promise.resolve().then(a.bind(a,5580))},5580:(e,s,a)=>{"use strict";a.r(s),a.d(s,{default:()=>y});var t=a(8307),n=a(3603),i=a(997),r=a(5384),c=a(328),l=a(760),d=a(9418),o=a(3411),m=a(9915),u=a(5381),x=a(8743),h=a(2889),p=a(3660),j=a(540),f=a(8191),N=a(8443),g=a(5803),b=a.n(g),v=a(8061);function y(){let{get:e,post:s,del:a}=(0,v.g)(),g=(0,i.jE)(),[y,w]=(0,n.useState)(null),[q,k]=(0,n.useState)("waiting"),{data:A,isLoading:C,refetch:S}=(0,r.I)({queryKey:["admin-queues"],queryFn:()=>e("/api/v1/admin/queues"),refetchInterval:5e3}),{data:O,isLoading:F}=(0,r.I)({queryKey:["queue-jobs",y,q],queryFn:()=>e("/api/v1/admin/queues/".concat(y,"/jobs?status=").concat(q,"&limit=50")),enabled:!!y}),E=(0,c.n)({mutationFn:e=>s("/api/v1/admin/queues/".concat(e,"/pause"),{}),onSuccess:()=>{g.invalidateQueries({queryKey:["admin-queues"]})}}),P=(0,c.n)({mutationFn:e=>s("/api/v1/admin/queues/".concat(e,"/resume"),{}),onSuccess:()=>{g.invalidateQueries({queryKey:["admin-queues"]})}}),K=(0,c.n)({mutationFn:e=>{let{queueName:a,jobId:t}=e;return s("/api/v1/admin/queues/".concat(a,"/jobs/").concat(t,"/retry"),{})},onSuccess:()=>{g.invalidateQueries({queryKey:["queue-jobs"]})}}),I=(0,c.n)({mutationFn:e=>{let{queueName:s,jobId:t}=e;return a("/api/v1/admin/queues/".concat(s,"/jobs/").concat(t))},onSuccess:()=>{g.invalidateQueries({queryKey:["queue-jobs"]})}}),R=(0,c.n)({mutationFn:e=>{let{queueName:a,status:t}=e;return s("/api/v1/admin/queues/".concat(a,"/clean?status=").concat(t),{})},onSuccess:()=>{g.invalidateQueries({queryKey:["admin-queues"]}),g.invalidateQueries({queryKey:["queue-jobs"]})}}),T=e=>new Date(e).toLocaleString("pt-BR");return(0,t.jsxs)("div",{className:"space-y-6",children:[(0,t.jsxs)("div",{className:"flex items-center justify-between",children:[(0,t.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,t.jsx)(b(),{href:"/admin",className:"p-2 hover:bg-accent rounded-md transition-colors",children:(0,t.jsx)(x.A,{className:"h-5 w-5"})}),(0,t.jsxs)("div",{children:[(0,t.jsxs)("h1",{className:"text-2xl font-semibold tracking-tight flex items-center gap-2",children:[(0,t.jsx)(h.A,{className:"h-6 w-6"}),"Gerenciamento de Filas"]}),(0,t.jsx)("p",{className:"text-muted-foreground",children:"Monitore e gerencie as filas de processamento"})]})]}),(0,t.jsxs)("button",{onClick:()=>S(),className:"inline-flex items-center justify-center rounded-md border px-4 py-2 text-sm font-medium hover:bg-accent",children:[(0,t.jsx)(d.A,{className:"mr-2 h-4 w-4"}),"Atualizar"]})]}),(0,t.jsxs)("div",{className:"grid gap-6 lg:grid-cols-3",children:[(0,t.jsxs)("div",{className:"rounded-lg border bg-card",children:[(0,t.jsx)("div",{className:"border-b px-4 py-3",children:(0,t.jsx)("h2",{className:"font-semibold",children:"Filas"})}),C?(0,t.jsx)("div",{className:"p-8 flex justify-center",children:(0,t.jsx)(d.A,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):(0,t.jsx)("div",{className:"divide-y",children:null==A?void 0:A.map(e=>(0,t.jsxs)("div",{className:"p-4 cursor-pointer transition-colors ".concat(y===e.name?"bg-muted":"hover:bg-muted/50"),onClick:()=>w(e.name),children:[(0,t.jsxs)("div",{className:"flex items-center justify-between mb-2",children:[(0,t.jsx)("span",{className:"font-medium",children:e.name}),(0,t.jsx)("span",{className:"text-xs px-2 py-1 rounded-full ".concat(e.paused?"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30":"bg-green-100 text-green-700 dark:bg-green-900/30"),children:e.paused?"Pausada":"Ativa"})]}),(0,t.jsxs)("div",{className:"grid grid-cols-3 gap-2 text-xs",children:[(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Aguardando"}),(0,t.jsx)("p",{className:"font-semibold text-yellow-600",children:e.waiting})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Completas"}),(0,t.jsx)("p",{className:"font-semibold text-green-600",children:e.completed})]}),(0,t.jsxs)("div",{className:"text-center",children:[(0,t.jsx)("p",{className:"text-muted-foreground",children:"Falhas"}),(0,t.jsx)("p",{className:"font-semibold text-red-600",children:e.failed})]})]}),(0,t.jsxs)("div",{className:"mt-3 flex gap-2",children:[e.paused?(0,t.jsxs)("button",{onClick:s=>{s.stopPropagation(),P.mutate(e.name)},className:"flex-1 inline-flex items-center justify-center rounded-md border px-2 py-1 text-xs hover:bg-accent",children:[(0,t.jsx)(p.A,{className:"mr-1 h-3 w-3"}),"Resumir"]}):(0,t.jsxs)("button",{onClick:s=>{s.stopPropagation(),E.mutate(e.name)},className:"flex-1 inline-flex items-center justify-center rounded-md border px-2 py-1 text-xs hover:bg-accent",children:[(0,t.jsx)(j.A,{className:"mr-1 h-3 w-3"}),"Pausar"]}),(0,t.jsxs)("button",{onClick:s=>{s.stopPropagation(),R.mutate({queueName:e.name,status:"completed"})},className:"flex-1 inline-flex items-center justify-center rounded-md border px-2 py-1 text-xs hover:bg-accent",children:[(0,t.jsx)(f.A,{className:"mr-1 h-3 w-3"}),"Limpar"]})]})]},e.name))})]}),(0,t.jsxs)("div",{className:"lg:col-span-2 rounded-lg border bg-card",children:[(0,t.jsxs)("div",{className:"border-b px-4 py-3 flex items-center justify-between",children:[(0,t.jsxs)("h2",{className:"font-semibold",children:["Jobs ",y&&"- ".concat(y)]}),y&&(0,t.jsx)("div",{className:"flex gap-1",children:["waiting","active","completed","failed","delayed"].map(e=>(0,t.jsx)("button",{onClick:()=>k(e),className:"px-2 py-1 text-xs rounded-md transition-colors ".concat(q===e?"bg-primary text-primary-foreground":"border hover:bg-accent"),children:e},e))})]}),y?F?(0,t.jsx)("div",{className:"p-8 flex justify-center",children:(0,t.jsx)(d.A,{className:"h-6 w-6 animate-spin text-muted-foreground"})}):(null==O?void 0:O.length)===0?(0,t.jsxs)("div",{className:"p-8 text-center text-muted-foreground",children:[(0,t.jsx)(o.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsxs)("p",{children:['Nenhum job com status "',q,'"']})]}):(0,t.jsx)("div",{className:"divide-y max-h-[600px] overflow-y-auto",children:null==O?void 0:O.map(e=>(0,t.jsx)("div",{className:"p-4 hover:bg-muted/50",children:(0,t.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,t.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,t.jsxs)("div",{className:"flex items-center gap-2",children:[(e=>{switch(e){case"waiting":return(0,t.jsx)(l.A,{className:"h-4 w-4 text-yellow-500"});case"active":return(0,t.jsx)(d.A,{className:"h-4 w-4 text-blue-500 animate-spin"});case"completed":return(0,t.jsx)(o.A,{className:"h-4 w-4 text-green-500"});case"failed":return(0,t.jsx)(m.A,{className:"h-4 w-4 text-red-500"});case"delayed":return(0,t.jsx)(u.A,{className:"h-4 w-4 text-orange-500"});default:return null}})(q),(0,t.jsx)("span",{className:"font-mono text-sm",children:e.id}),(0,t.jsxs)("span",{className:"text-xs text-muted-foreground",children:["(",e.name,")"]})]}),(0,t.jsxs)("div",{className:"mt-2 text-xs text-muted-foreground",children:[(0,t.jsxs)("p",{children:["Criado: ",T(e.timestamp)]}),e.processedOn&&(0,t.jsxs)("p",{children:["Processado: ",T(e.processedOn)]}),e.finishedOn&&(0,t.jsxs)("p",{children:["Finalizado: ",T(e.finishedOn)]}),(0,t.jsxs)("p",{children:["Tentativas: ",e.attempts]})]}),e.failedReason&&(0,t.jsx)("p",{className:"mt-2 text-xs text-red-600 bg-red-50 dark:bg-red-900/20 p-2 rounded",children:e.failedReason}),(0,t.jsxs)("details",{className:"mt-2",children:[(0,t.jsx)("summary",{className:"text-xs text-muted-foreground cursor-pointer",children:"Ver dados"}),(0,t.jsx)("pre",{className:"mt-1 text-xs bg-muted p-2 rounded overflow-x-auto",children:JSON.stringify(e.data,null,2)})]})]}),(0,t.jsxs)("div",{className:"flex gap-1",children:["failed"===q&&(0,t.jsx)("button",{onClick:()=>K.mutate({queueName:y,jobId:e.id}),className:"p-2 rounded-md border hover:bg-accent",title:"Retry",children:(0,t.jsx)(N.A,{className:"h-4 w-4"})}),(0,t.jsx)("button",{onClick:()=>I.mutate({queueName:y,jobId:e.id}),className:"p-2 rounded-md border hover:bg-accent text-red-600",title:"Remove",children:(0,t.jsx)(f.A,{className:"h-4 w-4"})})]})]})},e.id))}):(0,t.jsxs)("div",{className:"p-8 text-center text-muted-foreground",children:[(0,t.jsx)(h.A,{className:"h-12 w-12 mx-auto mb-4 opacity-50"}),(0,t.jsx)("p",{children:"Selecione uma fila para ver os jobs"})]})]})]})]})}},8061:(e,s,a)=>{"use strict";a.d(s,{g:()=>i});var t=a(3603);let n="trackpro_auth";function i(){let e=(0,t.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=function(){let e=localStorage.getItem(n);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}(),t={"Content-Type":"application/json",...s.headers};a&&(t.Authorization="Bearer ".concat(a.accessToken));let i=await fetch("".concat("http://localhost:3001").concat(e),{...s,headers:t});if(!i.ok){let e=await i.json().catch(()=>({}));throw 401===i.status&&(localStorage.removeItem(n),window.location.pathname.includes("/login")||(window.location.href="/login")),Error(e.message||"Request failed: ".concat(i.status))}return 204===i.status?{}:i.json()},[]),s=(0,t.useCallback)(s=>e(s,{method:"GET"}),[e]),a=(0,t.useCallback)((s,a)=>e(s,{method:"POST",body:a?JSON.stringify(a):void 0}),[e]),i=(0,t.useCallback)((s,a)=>e(s,{method:"PUT",body:a?JSON.stringify(a):void 0}),[e]),r=(0,t.useCallback)((s,a)=>e(s,{method:"DELETE",body:a?JSON.stringify(a):void 0}),[e]);return{request:e,get:s,post:a,put:i,del:r}}}},e=>{e.O(0,[5803,2198,528,3377,6438,2453,7358],()=>e(e.s=392)),_N_E=e.O()}]);