(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2465],{3:(e,s,t)=>{Promise.resolve().then(t.bind(t,2356))},2356:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>A});var a=t(8307),r=t(3603),n=t(4844),l=t(997),i=t(5384),o=t(328),c=t(760),d=t(292),m=t(1246),x=t(6510),u=t(8743),p=t(9418),h=t(8166),g=t(4646),f=t(1791),b=t(7589),j=t(3947),N=t(716),v=t(5381),y=t(5803),w=t.n(y),k=t(8061);let E={EVENTS_RAW:{label:"Eventos Brutos",description:"Exportar todos os eventos com dados completos"},EVENTS_AGG:{label:"Eventos Agregados",description:"Dados agregados por dia/evento"},FUNNEL:{label:"Funil",description:"Dados de convers\xe3o do funil"},REVENUE:{label:"Receita",description:"Relat\xf3rio de receita e transa\xe7\xf5es"}},C={PENDING:{label:"Pendente",color:"bg-yellow-100 text-yellow-700 dark:bg-yellow-900/30 dark:text-yellow-400",icon:c.A},PROCESSING:{label:"Processando",color:"bg-blue-100 text-blue-700 dark:bg-blue-900/30 dark:text-blue-400",icon:d.A},COMPLETED:{label:"Conclu\xeddo",color:"bg-green-100 text-green-700 dark:bg-green-900/30 dark:text-green-400",icon:m.A},FAILED:{label:"Falhou",color:"bg-red-100 text-red-700 dark:bg-red-900/30 dark:text-red-400",icon:x.A}};function A(){var e;let s=(0,n.useParams)().id,{get:t,post:c,del:m}=(0,k.g)(),y=(0,l.jE)(),[A,S]=(0,r.useState)(!1),[D,P]=(0,r.useState)("EVENTS_RAW"),[F,O]=(0,r.useState)("csv"),[R,T]=(0,r.useState)(""),[_,I]=(0,r.useState)(""),{data:L}=(0,i.I)({queryKey:["tenants"],queryFn:()=>t("/api/v1/tenants")}),q=null==L||null==(e=L[0])?void 0:e.id,{data:G,isLoading:V,refetch:B,isFetching:J}=(0,i.I)({queryKey:["exports",q,s],queryFn:()=>t("/api/v1/tenants/".concat(q,"/projects/").concat(s,"/exports")),enabled:!!q,refetchInterval:1e4}),U=(0,o.n)({mutationFn:e=>c("/api/v1/tenants/".concat(q,"/projects/").concat(s,"/exports"),e),onSuccess:()=>{y.invalidateQueries({queryKey:["exports",q,s]}),S(!1),W()}}),K=(0,o.n)({mutationFn:e=>m("/api/v1/tenants/".concat(q,"/projects/").concat(s,"/exports/").concat(e)),onSuccess:()=>{y.invalidateQueries({queryKey:["exports",q,s]})}}),z=async e=>{try{let a=await t("/api/v1/tenants/".concat(q,"/projects/").concat(s,"/exports/").concat(e,"/download"));window.open(a.downloadUrl,"_blank")}catch(e){console.error("Failed to get download URL:",e)}},W=()=>{P("EVENTS_RAW"),O("csv"),T(""),I("")};return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(w(),{href:"/projects/".concat(s),className:"p-2 hover:bg-accent rounded-md transition-colors",children:(0,a.jsx)(u.A,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h1",{className:"text-2xl font-semibold tracking-tight",children:"Exportar Dados"}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Exporte seus dados de analytics em CSV ou JSON"})]})]}),(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsxs)("button",{onClick:()=>B(),disabled:J,className:"inline-flex items-center justify-center rounded-md border px-4 py-2 text-sm font-medium hover:bg-accent disabled:opacity-50",children:[(0,a.jsx)(p.A,{className:"mr-2 h-4 w-4 ".concat(J?"animate-spin":"")}),"Atualizar"]}),(0,a.jsxs)("button",{onClick:()=>S(!0),className:"inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90",children:[(0,a.jsx)(h.A,{className:"mr-2 h-4 w-4"}),"Nova Exporta\xe7\xe3o"]})]})]}),(0,a.jsx)("div",{className:"grid gap-4 sm:grid-cols-2 lg:grid-cols-4",children:Object.entries(E).map(e=>{let[s,t]=e;return(0,a.jsxs)("div",{className:"rounded-lg border bg-card p-4 hover:border-primary/50 transition-colors cursor-pointer",onClick:()=>{P(s),S(!0)},children:[(0,a.jsxs)("div",{className:"flex items-center space-x-2",children:[(0,a.jsx)(g.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("p",{className:"font-medium",children:t.label})]}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:t.description})]},s)})}),(0,a.jsxs)("div",{className:"rounded-lg border bg-card",children:[(0,a.jsx)("div",{className:"border-b px-4 py-3",children:(0,a.jsx)("h2",{className:"font-semibold",children:"Hist\xf3rico de Exporta\xe7\xf5es"})}),V?(0,a.jsxs)("div",{className:"p-8 flex flex-col items-center justify-center",children:[(0,a.jsx)(p.A,{className:"h-8 w-8 animate-spin text-muted-foreground"}),(0,a.jsx)("p",{className:"mt-4 text-sm text-muted-foreground",children:"Carregando exporta\xe7\xf5es..."})]}):G&&0!==G.length?(0,a.jsx)("div",{className:"divide-y",children:G.map(e=>{let s=C[e.status],t=E[e.type],r=s.icon,n="json"===e.params.format?b.A:f.A;return(0,a.jsx)("div",{className:"p-4 hover:bg-accent/50 transition-colors",children:(0,a.jsxs)("div",{className:"flex items-start justify-between gap-4",children:[(0,a.jsxs)("div",{className:"flex-1 min-w-0",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2",children:[(0,a.jsx)(n,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"font-medium",children:t.label}),(0,a.jsxs)("span",{className:"inline-flex items-center gap-1 rounded-full px-2 py-1 text-xs font-medium ".concat(s.color),children:[(0,a.jsx)(r,{className:"h-3 w-3 ".concat("PROCESSING"===e.status?"animate-spin":"")}),s.label]})]}),(0,a.jsxs)("div",{className:"mt-2 flex flex-wrap items-center gap-2 text-sm text-muted-foreground",children:[(0,a.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,a.jsx)(j.A,{className:"h-3 w-3"}),new Date(e.createdAt).toLocaleString("pt-BR",{day:"2-digit",month:"2-digit",year:"numeric",hour:"2-digit",minute:"2-digit"})]}),e.params.startDate&&(0,a.jsxs)("span",{className:"inline-flex items-center gap-1",children:[(0,a.jsx)(N.A,{className:"h-3 w-3"}),new Date(e.params.startDate).toLocaleDateString("pt-BR"),e.params.endDate&&(0,a.jsxs)(a.Fragment,{children:[" - ",new Date(e.params.endDate).toLocaleDateString("pt-BR")]})]})]}),e.error&&(0,a.jsxs)("p",{className:"mt-2 text-sm text-red-600 dark:text-red-400",children:["Erro: ",e.error]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2",children:["COMPLETED"===e.status&&e.fileUrl&&(0,a.jsxs)("button",{onClick:()=>z(e.id),className:"inline-flex items-center justify-center rounded-md bg-primary px-3 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90",children:[(0,a.jsx)(g.A,{className:"mr-1 h-4 w-4"}),"Baixar"]}),"PENDING"===e.status&&(0,a.jsx)("button",{onClick:()=>K.mutate(e.id),disabled:K.isPending,className:"inline-flex items-center justify-center rounded-md border border-red-200 px-3 py-2 text-sm font-medium text-red-600 hover:bg-red-50 dark:border-red-900 dark:hover:bg-red-950 disabled:opacity-50",children:K.isPending?(0,a.jsx)(d.A,{className:"h-4 w-4 animate-spin"}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(x.A,{className:"mr-1 h-4 w-4"}),"Cancelar"]})})]})]})},e.id)})}):(0,a.jsxs)("div",{className:"p-8 flex flex-col items-center justify-center text-center",children:[(0,a.jsx)(f.A,{className:"h-12 w-12 text-muted-foreground/50"}),(0,a.jsx)("h3",{className:"mt-4 font-semibold",children:"Nenhuma exporta\xe7\xe3o"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:'Clique em "Nova Exporta\xe7\xe3o" para come\xe7ar'})]})]}),A&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsxs)("div",{className:"w-full max-w-md rounded-lg border bg-background p-6 shadow-lg",children:[(0,a.jsx)("h2",{className:"text-lg font-semibold",children:"Nova Exporta\xe7\xe3o"}),(0,a.jsx)("p",{className:"mt-1 text-sm text-muted-foreground",children:"Configure os par\xe2metros da exporta\xe7\xe3o"}),(0,a.jsxs)("div",{className:"mt-6 space-y-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Tipo de Exporta\xe7\xe3o"}),(0,a.jsx)("select",{value:D,onChange:e=>P(e.target.value),className:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2",children:Object.entries(E).map(e=>{let[s,t]=e;return(0,a.jsx)("option",{value:s,children:t.label},s)})}),(0,a.jsx)("p",{className:"mt-1 text-xs text-muted-foreground",children:E[D].description})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Formato"}),(0,a.jsxs)("div",{className:"mt-2 flex gap-4",children:[(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"format",value:"csv",checked:"csv"===F,onChange:()=>O("csv"),className:"h-4 w-4"}),(0,a.jsx)(f.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:"CSV"})]}),(0,a.jsxs)("label",{className:"flex items-center gap-2 cursor-pointer",children:[(0,a.jsx)("input",{type:"radio",name:"format",value:"json",checked:"json"===F,onChange:()=>O("json"),className:"h-4 w-4"}),(0,a.jsx)(b.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-sm",children:"JSON"})]})]})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Data Inicial"}),(0,a.jsx)("input",{type:"date",value:R,onChange:e=>T(e.target.value),className:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})]}),(0,a.jsxs)("div",{children:[(0,a.jsx)("label",{className:"text-sm font-medium",children:"Data Final"}),(0,a.jsx)("input",{type:"date",value:_,onChange:e=>I(e.target.value),className:"mt-1 flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2"})]})]}),(0,a.jsxs)("div",{className:"flex items-center gap-2 rounded-md border border-yellow-200 bg-yellow-50 p-3 dark:border-yellow-900 dark:bg-yellow-950",children:[(0,a.jsx)(v.A,{className:"h-4 w-4 text-yellow-600 dark:text-yellow-400"}),(0,a.jsx)("p",{className:"text-xs text-yellow-700 dark:text-yellow-300",children:"Exporta\xe7\xf5es podem levar alguns minutos dependendo do volume de dados"})]})]}),(0,a.jsxs)("div",{className:"mt-6 flex justify-end gap-2",children:[(0,a.jsx)("button",{onClick:()=>{S(!1),W()},className:"inline-flex items-center justify-center rounded-md border px-4 py-2 text-sm font-medium hover:bg-accent",children:"Cancelar"}),(0,a.jsx)("button",{onClick:()=>{U.mutate({type:D,format:F,startDate:R||void 0,endDate:_||void 0})},disabled:U.isPending,className:"inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90 disabled:opacity-50",children:U.isPending?(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(d.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Criando..."]}):(0,a.jsxs)(a.Fragment,{children:[(0,a.jsx)(g.A,{className:"mr-2 h-4 w-4"}),"Criar Exporta\xe7\xe3o"]})})]})]})})]})}},8061:(e,s,t)=>{"use strict";t.d(s,{g:()=>n});var a=t(3603);let r="trackpro_auth";function n(){let e=(0,a.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=function(){let e=localStorage.getItem(r);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}(),a={"Content-Type":"application/json",...s.headers};t&&(a.Authorization="Bearer ".concat(t.accessToken));let n=await fetch("".concat("http://localhost:3001").concat(e),{...s,headers:a});if(!n.ok){let e=await n.json().catch(()=>({}));throw 401===n.status&&(localStorage.removeItem(r),window.location.pathname.includes("/login")||(window.location.href="/login")),Error(e.message||"Request failed: ".concat(n.status))}return 204===n.status?{}:n.json()},[]),s=(0,a.useCallback)(s=>e(s,{method:"GET"}),[e]),t=(0,a.useCallback)((s,t)=>e(s,{method:"POST",body:t?JSON.stringify(t):void 0}),[e]),n=(0,a.useCallback)((s,t)=>e(s,{method:"PUT",body:t?JSON.stringify(t):void 0}),[e]),l=(0,a.useCallback)((s,t)=>e(s,{method:"DELETE",body:t?JSON.stringify(t):void 0}),[e]);return{request:e,get:s,post:t,put:n,del:l}}}},e=>{e.O(0,[5803,2198,528,9896,6438,2453,7358],()=>e(e.s=3)),_N_E=e.O()}]);