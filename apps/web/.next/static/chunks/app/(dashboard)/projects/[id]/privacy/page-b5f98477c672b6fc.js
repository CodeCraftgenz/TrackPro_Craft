(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[9050],{578:(e,s,t)=>{Promise.resolve().then(t.bind(t,6879))},6879:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>w});var a=t(8307),n=t(3603),r=t(4844),l=t(997),o=t(5384),d=t(328),i=t(8743),c=t(4520),m=t(5381),u=t(2330),x=t(6353),h=t(9418),p=t(7276),g=t(1319),f=t(3947),j=t(5256),v=t(8191),N=t(5803),b=t.n(N),y=t(8061);function w(){var e,s,t;let N=(0,r.useParams)().id,{get:w,del:k,post:C}=(0,y.g)(),A=(0,l.jE)(),[S,E]=(0,n.useState)(""),[D,I]=(0,n.useState)(null),[q,P]=(0,n.useState)(!1),[L,z]=(0,n.useState)(!1),[R,_]=(0,n.useState)(""),{data:B}=(0,o.I)({queryKey:["tenants"],queryFn:()=>w("/api/v1/tenants")}),O=null==B||null==(e=B[0])?void 0:e.id,{data:T,isLoading:K,refetch:U}=(0,o.I)({queryKey:["privacy-users",O,N,S],queryFn:()=>w("/api/v1/tenants/".concat(O,"/projects/").concat(N,"/privacy/users?query=").concat(encodeURIComponent(S),"&limit=50")),enabled:!!O}),{data:F,isLoading:G}=(0,o.I)({queryKey:["user-summary",O,N,D],queryFn:()=>w("/api/v1/tenants/".concat(O,"/projects/").concat(N,"/privacy/users/").concat(encodeURIComponent(D))),enabled:!!O&&!!D}),J=(0,d.n)({mutationFn:async e=>k("/api/v1/tenants/".concat(O,"/projects/").concat(N,"/privacy/users/").concat(encodeURIComponent(e)),{reason:R}),onSuccess:()=>{A.invalidateQueries({queryKey:["privacy-users"]}),A.invalidateQueries({queryKey:["user-summary"]}),P(!1),I(null),_("")}}),Q=(0,d.n)({mutationFn:async e=>C("/api/v1/tenants/".concat(O,"/projects/").concat(N,"/privacy/users/").concat(encodeURIComponent(e),"/anonymize"),{reason:R}),onSuccess:()=>{A.invalidateQueries({queryKey:["privacy-users"]}),A.invalidateQueries({queryKey:["user-summary"]}),z(!1),I(null),_("")}});return(0,a.jsxs)("div",{className:"space-y-6",children:[(0,a.jsx)("div",{className:"flex items-center justify-between",children:(0,a.jsxs)("div",{className:"flex items-center space-x-4",children:[(0,a.jsx)(b(),{href:"/projects/".concat(N),className:"p-2 hover:bg-accent rounded-md transition-colors",children:(0,a.jsx)(i.A,{className:"h-5 w-5"})}),(0,a.jsxs)("div",{children:[(0,a.jsxs)("h1",{className:"text-2xl font-semibold tracking-tight flex items-center gap-2",children:[(0,a.jsx)(c.A,{className:"h-6 w-6"}),"Privacidade (LGPD)"]}),(0,a.jsx)("p",{className:"text-muted-foreground",children:"Gerencie dados de usu\xe1rios e solicita\xe7\xf5es de privacidade"})]})]})}),(0,a.jsx)("div",{className:"rounded-lg border border-yellow-200 bg-yellow-50 p-4 dark:border-yellow-800 dark:bg-yellow-900/20",children:(0,a.jsxs)("div",{className:"flex items-start gap-3",children:[(0,a.jsx)(m.A,{className:"h-5 w-5 text-yellow-600 dark:text-yellow-400 mt-0.5"}),(0,a.jsxs)("div",{children:[(0,a.jsx)("h3",{className:"font-medium text-yellow-800 dark:text-yellow-200",children:"A\xe7\xf5es de Privacidade (LGPD)"}),(0,a.jsx)("p",{className:"text-sm text-yellow-700 dark:text-yellow-300 mt-1",children:"As a\xe7\xf5es de exclus\xe3o e anonimiza\xe7\xe3o s\xe3o irrevers\xedveis. Certifique-se de que a solicita\xe7\xe3o \xe9 leg\xedtima antes de prosseguir. Todas as a\xe7\xf5es s\xe3o registradas para fins de auditoria."})]})]})}),(0,a.jsx)("div",{className:"rounded-lg border bg-card p-4",children:(0,a.jsxs)("form",{onSubmit:e=>{e.preventDefault(),U()},className:"flex gap-3",children:[(0,a.jsxs)("div",{className:"relative flex-1",children:[(0,a.jsx)(u.A,{className:"absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground"}),(0,a.jsx)("input",{type:"text",placeholder:"Buscar por anonymous_id...",value:S,onChange:e=>E(e.target.value),className:"h-10 w-full rounded-md border border-input bg-background pl-10 pr-3 text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),(0,a.jsx)("button",{type:"submit",className:"inline-flex items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground hover:bg-primary/90",children:"Buscar"})]})}),(0,a.jsxs)("div",{className:"grid gap-6 lg:grid-cols-2",children:[(0,a.jsxs)("div",{className:"rounded-lg border bg-card",children:[(0,a.jsx)("div",{className:"border-b px-4 py-3",children:(0,a.jsxs)("h3",{className:"font-medium flex items-center gap-2",children:[(0,a.jsx)(x.A,{className:"h-4 w-4"}),"Usu\xe1rios (",(null==T?void 0:T.total)||0,")"]})}),K?(0,a.jsxs)("div",{className:"p-8 flex flex-col items-center justify-center",children:[(0,a.jsx)(h.A,{className:"h-6 w-6 animate-spin text-muted-foreground"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Carregando..."})]}):(null==T||null==(s=T.users)?void 0:s.length)===0?(0,a.jsxs)("div",{className:"p-8 text-center text-muted-foreground",children:[(0,a.jsx)(x.A,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"Nenhum usu\xe1rio encontrado"})]}):(0,a.jsx)("div",{className:"divide-y max-h-96 overflow-y-auto",children:null==T||null==(t=T.users)?void 0:t.map(e=>(0,a.jsxs)("button",{onClick:()=>I(e.anonymousId),className:"w-full px-4 py-3 text-left hover:bg-muted/50 transition-colors ".concat(D===e.anonymousId?"bg-muted":""),children:[(0,a.jsxs)("div",{className:"flex items-center justify-between",children:[(0,a.jsx)("div",{className:"font-mono text-sm truncate max-w-[200px]",children:e.anonymousId}),(0,a.jsxs)("span",{className:"text-xs text-muted-foreground",children:[e.consentLogsCount," registros"]})]}),(0,a.jsxs)("div",{className:"text-xs text-muted-foreground mt-1",children:["\xdaltima atividade:"," ",new Date(e.lastActivity).toLocaleDateString("pt-BR")]})]},e.anonymousId))})]}),(0,a.jsxs)("div",{className:"rounded-lg border bg-card",children:[(0,a.jsx)("div",{className:"border-b px-4 py-3",children:(0,a.jsxs)("h3",{className:"font-medium flex items-center gap-2",children:[(0,a.jsx)(p.A,{className:"h-4 w-4"}),"Detalhes do Usu\xe1rio"]})}),D?G?(0,a.jsxs)("div",{className:"p-8 flex flex-col items-center justify-center",children:[(0,a.jsx)(h.A,{className:"h-6 w-6 animate-spin text-muted-foreground"}),(0,a.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Carregando..."})]}):F?(0,a.jsxs)("div",{className:"p-4 space-y-4",children:[(0,a.jsxs)("div",{className:"space-y-3",children:[(0,a.jsxs)("div",{children:[(0,a.jsx)("p",{className:"text-xs text-muted-foreground",children:"Anonymous ID"}),(0,a.jsx)("p",{className:"font-mono text-sm break-all",children:F.anonymousId})]}),(0,a.jsxs)("div",{className:"grid grid-cols-2 gap-4",children:[(0,a.jsxs)("div",{className:"rounded-lg border p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,a.jsx)(g.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-xs",children:"Eventos"})]}),(0,a.jsx)("p",{className:"text-xl font-semibold mt-1",children:F.eventCount.toLocaleString("pt-BR")})]}),(0,a.jsxs)("div",{className:"rounded-lg border p-3",children:[(0,a.jsxs)("div",{className:"flex items-center gap-2 text-muted-foreground",children:[(0,a.jsx)(p.A,{className:"h-4 w-4"}),(0,a.jsx)("span",{className:"text-xs",children:"Consents"})]}),(0,a.jsx)("p",{className:"text-xl font-semibold mt-1",children:F.consentLogsCount.toLocaleString("pt-BR")})]})]}),F.firstSeen&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(f.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"Primeira atividade:"}),(0,a.jsx)("span",{children:new Date(F.firstSeen).toLocaleDateString("pt-BR")})]}),F.lastSeen&&(0,a.jsxs)("div",{className:"flex items-center gap-2 text-sm",children:[(0,a.jsx)(f.A,{className:"h-4 w-4 text-muted-foreground"}),(0,a.jsx)("span",{className:"text-muted-foreground",children:"\xdaltima atividade:"}),(0,a.jsx)("span",{children:new Date(F.lastSeen).toLocaleDateString("pt-BR")})]})]}),(0,a.jsxs)("div",{className:"border-t pt-4 space-y-3",children:[(0,a.jsx)("h4",{className:"font-medium text-sm",children:"A\xe7\xf5es de Privacidade"}),(0,a.jsxs)("button",{onClick:()=>z(!0),className:"w-full inline-flex items-center justify-center gap-2 rounded-md border px-4 py-2 text-sm font-medium hover:bg-accent",children:[(0,a.jsx)(j.A,{className:"h-4 w-4"}),"Anonimizar Dados"]}),(0,a.jsxs)("button",{onClick:()=>P(!0),className:"w-full inline-flex items-center justify-center gap-2 rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700",children:[(0,a.jsx)(v.A,{className:"h-4 w-4"}),"Excluir Todos os Dados"]})]})]}):null:(0,a.jsxs)("div",{className:"p-8 text-center text-muted-foreground",children:[(0,a.jsx)(c.A,{className:"h-8 w-8 mx-auto mb-2 opacity-50"}),(0,a.jsx)("p",{children:"Selecione um usu\xe1rio para ver os detalhes"})]})]})]}),q&&D&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsxs)("div",{className:"w-full max-w-md rounded-lg bg-background p-6 shadow-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 text-red-600",children:[(0,a.jsx)(m.A,{className:"h-6 w-6"}),(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Confirmar Exclus\xe3o"})]}),(0,a.jsxs)("p",{className:"mt-4 text-sm text-muted-foreground",children:["Voc\xea est\xe1 prestes a excluir permanentemente todos os dados do usu\xe1rio"," ",(0,a.jsx)("code",{className:"bg-muted px-1 rounded",children:D}),". Esta a\xe7\xe3o \xe9 irrevers\xedvel."]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Motivo da exclus\xe3o (opcional)"}),(0,a.jsx)("textarea",{value:R,onChange:e=>_(e.target.value),placeholder:"Ex: Solicita\xe7\xe3o do titular dos dados via email...",className:"w-full h-20 rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),(0,a.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>{P(!1),_("")},className:"flex-1 rounded-md border px-4 py-2 text-sm font-medium hover:bg-accent",children:"Cancelar"}),(0,a.jsx)("button",{onClick:()=>J.mutate(D),disabled:J.isPending,className:"flex-1 rounded-md bg-red-600 px-4 py-2 text-sm font-medium text-white hover:bg-red-700 disabled:opacity-50",children:J.isPending?"Excluindo...":"Excluir Dados"})]})]})}),L&&D&&(0,a.jsx)("div",{className:"fixed inset-0 z-50 flex items-center justify-center bg-black/50",children:(0,a.jsxs)("div",{className:"w-full max-w-md rounded-lg bg-background p-6 shadow-lg",children:[(0,a.jsxs)("div",{className:"flex items-center gap-3 text-yellow-600",children:[(0,a.jsx)(j.A,{className:"h-6 w-6"}),(0,a.jsx)("h3",{className:"text-lg font-semibold",children:"Confirmar Anonimiza\xe7\xe3o"})]}),(0,a.jsxs)("p",{className:"mt-4 text-sm text-muted-foreground",children:["Voc\xea est\xe1 prestes a anonimizar os dados do usu\xe1rio"," ",(0,a.jsx)("code",{className:"bg-muted px-1 rounded",children:D}),". O anonymous_id ser\xe1 substitu\xeddo por um identificador aleat\xf3rio e dados pessoais ser\xe3o removidos. Esta a\xe7\xe3o \xe9 irrevers\xedvel."]}),(0,a.jsxs)("div",{className:"mt-4",children:[(0,a.jsx)("label",{className:"block text-sm font-medium mb-1",children:"Motivo da anonimiza\xe7\xe3o (opcional)"}),(0,a.jsx)("textarea",{value:R,onChange:e=>_(e.target.value),placeholder:"Ex: Solicita\xe7\xe3o do titular dos dados via email...",className:"w-full h-20 rounded-md border border-input bg-background px-3 py-2 text-sm placeholder:text-muted-foreground focus:outline-none focus:ring-2 focus:ring-primary"})]}),(0,a.jsxs)("div",{className:"mt-6 flex gap-3",children:[(0,a.jsx)("button",{onClick:()=>{z(!1),_("")},className:"flex-1 rounded-md border px-4 py-2 text-sm font-medium hover:bg-accent",children:"Cancelar"}),(0,a.jsx)("button",{onClick:()=>Q.mutate(D),disabled:Q.isPending,className:"flex-1 rounded-md bg-yellow-600 px-4 py-2 text-sm font-medium text-white hover:bg-yellow-700 disabled:opacity-50",children:Q.isPending?"Anonimizando...":"Anonimizar Dados"})]})]})})]})}},8061:(e,s,t)=>{"use strict";t.d(s,{g:()=>r});var a=t(3603);let n="trackpro_auth";function r(){let e=(0,a.useCallback)(async function(e){let s=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=function(){let e=localStorage.getItem(n);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}}(),a={"Content-Type":"application/json",...s.headers};t&&(a.Authorization="Bearer ".concat(t.accessToken));let r=await fetch("".concat("http://localhost:3001").concat(e),{...s,headers:a});if(!r.ok){let e=await r.json().catch(()=>({}));throw 401===r.status&&(localStorage.removeItem(n),window.location.pathname.includes("/login")||(window.location.href="/login")),Error(e.message||"Request failed: ".concat(r.status))}return 204===r.status?{}:r.json()},[]),s=(0,a.useCallback)(s=>e(s,{method:"GET"}),[e]),t=(0,a.useCallback)((s,t)=>e(s,{method:"POST",body:t?JSON.stringify(t):void 0}),[e]),r=(0,a.useCallback)((s,t)=>e(s,{method:"PUT",body:t?JSON.stringify(t):void 0}),[e]),l=(0,a.useCallback)((s,t)=>e(s,{method:"DELETE",body:t?JSON.stringify(t):void 0}),[e]);return{request:e,get:s,post:t,put:r,del:l}}}},e=>{e.O(0,[5803,2198,528,4442,6438,2453,7358],()=>e(e.s=578)),_N_E=e.O()}]);