(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[2678],{139:(e,s,t)=>{"use strict";t.r(s),t.d(s,{default:()=>f});var r=t(8307),a=t(3603),o=t(5803),i=t.n(o),n=t(3158),l=t(9763),c=t(8370),d=t(292),m=t(9889);let u=c.Ik({name:c.Yj().min(2,"Nome deve ter pelo menos 2 caracteres"),email:c.Yj().email("Email inv\xe1lido"),password:c.Yj().min(8,"Senha deve ter pelo menos 8 caracteres"),confirmPassword:c.Yj()}).refine(e=>e.password===e.confirmPassword,{message:"Senhas n\xe3o conferem",path:["confirmPassword"]});function f(){let{register:e}=(0,m.A)(),[s,t]=(0,a.useState)(null),{register:o,handleSubmit:c,formState:{errors:f,isSubmitting:p}}=(0,n.mN)({resolver:(0,l.u)(u)}),h=async s=>{t(null);try{await e(s.name,s.email,s.password)}catch(e){t(e instanceof Error?e.message:"Erro ao criar conta")}};return(0,r.jsx)("div",{className:"w-full max-w-md",children:(0,r.jsxs)("div",{className:"rounded-lg border bg-card p-8 shadow-sm",children:[(0,r.jsxs)("div",{className:"mb-6 text-center",children:[(0,r.jsx)("h1",{className:"text-2xl font-semibold tracking-tight",children:"Criar conta"}),(0,r.jsx)("p",{className:"mt-2 text-sm text-muted-foreground",children:"Comece a rastrear seus eventos hoje mesmo"})]}),(0,r.jsxs)("form",{onSubmit:c(h),className:"space-y-4",children:[s&&(0,r.jsx)("div",{className:"rounded-md bg-destructive/10 p-3 text-sm text-destructive",children:s}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{htmlFor:"name",className:"text-sm font-medium",children:"Nome"}),(0,r.jsx)("input",{id:"name",type:"text",autoComplete:"name",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"Seu nome",...o("name")}),f.name&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:f.name.message})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{htmlFor:"email",className:"text-sm font-medium",children:"Email"}),(0,r.jsx)("input",{id:"email",type:"email",autoComplete:"email",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"seu@email.com",...o("email")}),f.email&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:f.email.message})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{htmlFor:"password",className:"text-sm font-medium",children:"Senha"}),(0,r.jsx)("input",{id:"password",type:"password",autoComplete:"new-password",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"********",...o("password")}),f.password&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:f.password.message})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{htmlFor:"confirmPassword",className:"text-sm font-medium",children:"Confirmar senha"}),(0,r.jsx)("input",{id:"confirmPassword",type:"password",autoComplete:"new-password",className:"flex h-10 w-full rounded-md border border-input bg-background px-3 py-2 text-sm ring-offset-background placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50",placeholder:"********",...o("confirmPassword")}),f.confirmPassword&&(0,r.jsx)("p",{className:"text-sm text-destructive",children:f.confirmPassword.message})]}),(0,r.jsx)("button",{type:"submit",disabled:p,className:"inline-flex h-10 w-full items-center justify-center rounded-md bg-primary px-4 py-2 text-sm font-medium text-primary-foreground ring-offset-background transition-colors hover:bg-primary/90 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50",children:p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(d.A,{className:"mr-2 h-4 w-4 animate-spin"}),"Criando conta..."]}):"Criar conta"})]}),(0,r.jsxs)("div",{className:"mt-6 text-center text-sm text-muted-foreground",children:["J\xe1 tem conta?"," ",(0,r.jsx)(i(),{href:"/login",className:"font-medium text-primary hover:underline",children:"Fazer login"})]})]})})}},3540:(e,s,t)=>{Promise.resolve().then(t.bind(t,139))},9889:(e,s,t)=>{"use strict";t.d(s,{A:()=>d,O:()=>c});var r=t(8307),a=t(3603),o=t(4844);let i=(0,a.createContext)(void 0),n="http://localhost:3001",l="trackpro_auth";function c(e){let{children:s}=e,[t,c]=(0,a.useState)(null),[d,m]=(0,a.useState)(!0),u=(0,o.useRouter)(),f=()=>{let e=localStorage.getItem(l);if(!e)return null;try{return JSON.parse(e)}catch(e){return null}},p=e=>{let s={accessToken:e.accessToken,refreshToken:e.refreshToken,expiresAt:Date.now()+1e3*e.expiresIn};localStorage.setItem(l,JSON.stringify(s))},h=()=>{localStorage.removeItem(l)},g=(0,a.useCallback)(async e=>{try{let s=await fetch("".concat(n,"/api/v1/users/me"),{headers:{Authorization:"Bearer ".concat(e)}});if(!s.ok)return null;return s.json()}catch(e){return null}},[]),x=(0,a.useCallback)(async()=>{let e=f();if(!e){c(null),m(!1);return}if(e.expiresAt<Date.now()+6e4)try{let s=await fetch("".concat(n,"/api/v1/auth/refresh"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refreshToken:e.refreshToken})});if(!s.ok){h(),c(null),m(!1);return}let t=await s.json();p(t),e.accessToken=t.accessToken}catch(e){h(),c(null),m(!1);return}c(await g(e.accessToken)),m(!1)},[g]);(0,a.useEffect)(()=>{x()},[x]);let b=async(e,s)=>{let t=await fetch("".concat(n,"/api/v1/auth/login"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:e,password:s})});if(!t.ok)throw Error((await t.json()).message||"Login failed");let r=await t.json();p(r),c(await g(r.accessToken)),u.push("/projects")},v=async(e,s,t)=>{let r=await fetch("".concat(n,"/api/v1/auth/register"),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({name:e,email:s,password:t})});if(!r.ok)throw Error((await r.json()).message||"Registration failed");let a=await r.json();p(a),c(await g(a.accessToken)),u.push("/projects")},w=async()=>{let e=f();if(e)try{await fetch("".concat(n,"/api/v1/auth/logout"),{method:"POST",headers:{"Content-Type":"application/json",Authorization:"Bearer ".concat(e.accessToken)},body:JSON.stringify({refreshToken:e.refreshToken})})}catch(e){}h(),c(null),u.push("/login")};return(0,r.jsx)(i.Provider,{value:{user:t,isLoading:d,isAuthenticated:!!t,login:b,register:v,logout:w,refreshAuth:x},children:s})}function d(){let e=(0,a.useContext)(i);if(void 0===e)throw Error("useAuth must be used within an AuthProvider");return e}}},e=>{e.O(0,[5803,2718,6438,2453,7358],()=>e(e.s=3540)),_N_E=e.O()}]);